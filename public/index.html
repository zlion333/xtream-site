<!DOCTYPE html>
<html>
<body>

<h2>Login Xtream</h2>

<input id="server" placeholder="http://servidor:80"><br><br>
<input id="user" placeholder="Usuário"><br><br>
<input id="pass" placeholder="Senha" type="password"><br><br>

<button onclick="loadTV()">Carregar TV</button>

<ul id="lista"></ul>

<script>
async function loadTV() {
  try {
    const server = document.getElementById('server').value;
    const user = document.getElementById('user').value;
    const pass = document.getElementById('pass').value;

    const res = await fetch(`/api?server=${server}&user=${user}&pass=${pass}&action=get_live_streams`);

    if (!res.ok) {
      alert('Erro ao conectar ao servidor Xtream');
      return;
    }

    const text = await res.text();

    if (!text) {
      alert('Resposta vazia do servidor. Pode estar bloqueando acesso externo.');
      return;
    }

    const data = JSON.parse(text);

    const lista = document.getElementById('lista');
    lista.innerHTML = '';

    data.forEach(c => {
      const li = document.createElement('li');
      li.innerText = c.name;
      lista.appendChild(li);
    });
  } catch (e) {
    alert('Erro ao carregar canais. Verifique servidor, usuário e senha.');
    console.error(e);
  }
}
</script>

</body>
</html>
